schemaVersion: v0.2
prepare:
  steps:
    - name: check nix version
      command: |
        nix --version
    - name: install java and maven with updated nix
      command: |
        nix-env -iA nixpkgs.jdk17 nixpkgs.maven
    - name: verify installations
      command: |
        java -version && mvn -version
    - name: compile spring boot app with maven
      command: |
        cd backend && mvn clean compile
    - name: prepare frontend
      command: cd frontend && echo "Frontend static files ready"
test:
  steps: []
run:
  frontend:
    steps:
      - name: serve frontend static files
        command: "cd frontend && python3 -m http.server 3000"
    plan: 8
    replicas: 1
    isPublic: true
    network:
      path: /
      stripPath: false
  backend:
    steps:
      - name: start spring boot application
        command: |
          cd backend && mvn spring-boot:run -Dspring-boot.run.arguments="--server.port=3000"
    plan: 8
    replicas: 1
    isPublic: false
    network:
      path: /api
      stripPath: false